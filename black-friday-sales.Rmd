---
title: "Black-Friday Sales Prediction"
output: html_notebook
---

> Contest Link: https://datahack.analyticsvidhya.com/contest/black-friday/

### Problem Statement

A retail company “ABC Private Limited” wants to understand the customer purchase behaviour (specifically, purchase amount) against various products of different categories. They have shared purchase summary of various customers for selected high volume products from last month.
The data set also contains customer demographics (age, gender, marital status, city_type, stay_in_current_city), product details (product_id and product category) and Total purchase_amount from last month.

Now, they want to build a model to predict the purchase amount of customer against various products which will help them to create personalized offer for customers against different products.

### Solution

The dataset can be downloaded from [contest link](https://datahack.analyticsvidhya.com/contest/black-friday/). 

- Lets load the train and test dataset into the dataframe. As we see, header is present in the dataset, lets pass with the argument, `header=TRUE` to skip the first row.

```{r}
train.df <- read.csv("train.csv", header = TRUE)
test.df <- read.csv("test.csv", header = TRUE) 
```

- Starting with priliminary analysis, we first check the dimension of the data

```{r}
dim(train.df)
dim(test.df)
```

- Secondly, we run the below to check for missing values. Missing values can cause problems in the training phase if not taken care of before.

```{r}
any(is.na(train.df))
```

- Checking which columns, the missing values belong to

```{r}
names(which(sapply(train.df, anyNA)))
```

- Lets see the summary of each dataframes to get the count of the missing values in the training and test set. Summary provides an overall insight into the data.

```{r}
summary(train.df)
summary(test.df)
```

- Imputing the missing value with 20 in the training data

```{r}
train.df[10][is.na(train.df[10])] <- 20
train.df[11][is.na(train.df[11])] <- 20
```

- Imputing the missing value with 20, in the testing data

```{r}
test.df[10][is.na(test.df[10])] <- 20
test.df[11][is.na(test.df[11])] <- 20
```

- Checking the training and testing data to make sure there are no more missing values

```{r}
sum(is.na(train.df))
sum(is.na(test.df))
```


- Dividing both the datasets into features and labels for simplicity.

```{r}
X_train = train.df[3:11]
Y_train = train.df[12]
```

```{r}
X_test = test.df[3:11]  
```

```{r}
library(data.table)
library(mltools)
```

- One hot encoding features of the training and testing dataset as some columns are of string type.

```{r}
X_train <- one_hot(as.data.table(X_train))
X_test <- one_hot(as.data.table(X_test))

```

- Scaling column values to normalize them so as to bring uniformity in the data

```{r}
X_train$Product_Category_1 = scale(X_train$Product_Category_1)
X_train$Product_Category_2 = scale(X_train$Product_Category_2)
X_train$Product_Category_3 = scale(X_train$Product_Category_3)
```

```{r}

X_test$Product_Category_1 = scale(X_test$Product_Category_1)
X_test$Product_Category_2 = scale(X_test$Product_Category_2)
X_test$Product_Category_3 = scale(X_test$Product_Category_3)
```

- Adding a new column in the X_train.

```{r}
X_train$Purchases<- Y_train
```

```{r}
library(rpart)
```

- Initializing and training the model 

```{r}
model = rpart(Purchases~.,data = X_train)
```

- Predicting on test data

```{r}
Y_pred = predict(model, X_test)
```

- Recording the results

```{r}
df <- data.frame(User_ID = test.df$User_ID, Product_ID = test.df$Product_ID, Purchase = Y_pred)
```

- Writing the result to a csv file -result.csv.

```{r}
write.csv(df,"result.csv",row.names = FALSE)
```